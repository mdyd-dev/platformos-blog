{% query_graph 'modules/dashboard_blog/get_blog_instance' %}
{% if g.customizations.results == blank %}
  {% parse_json 'blog_instance' %}
    {
      "custom_model_type_name": "modules/dashboard_blog/blog_instance",
      "properties": [
        { "name": "title", "value": "PlatformOS Blog" },
        { "name": "subtitle", "value": "" } ,
        { "name": "enabled", "value": "true" },
        { "name": "slug", "value": "blog" },
        { "name": "scope", "value": "blog" },
        { "name": "sidebar_enabled", "value": "true" },
        { "name": "tags_filter", "value": "platformOS, Getting Started" },
        { "name": "grid_view_enabled", "value": "true" }
      ]
    }
  {% endparse_json %}
  {% execute_query 'modules/dashboard_blog/migration_create_customization', data: blog_instance %}

  {% assign image_url = 'modules/dashboard_blog/images/hero.jpg' | asset_url %}
  {% execute_query 'modules/dashboard_blog/create_image', result_name: "in", image_type: "header_image", owner_id: g.customization_create.id, raw_url: image_url %}

  {% parse_json 'blog_post' %}
  {
    "custom_model_type_name": "modules/dashboard_blog/blog_post",
    "properties": [
      { "name": "slug", "value": "getting-started" },
      { "name": "title", "value": "Getting Started Guide" },
      { "name": "tags", "value": "getting started" },
      { "name": "content", "value": "<h1>PlatformOS Blog - Getting Started Guite</h1><p>In this short introduction we will guide you though basic blog features so you can kickstart your blog in a matter of mintues. &nbsp;<span>As as administrator of your blog there are a few steps to follow for an effective blog setup:</span></p><br><p><strong>Administrator account creation</strong></p><ol>\r\n<li>\r\n<span>In this step you will learn how to setup administrator account.&nbsp;</span><br>\r\n</li>\r\n<li>\r\n<span>Go to http://you-page-url/sign-up and create new user.</span><br>\r\n</li>\r\n<li>\r\n<span>You will be redirected to the /log-in page with a proper message: \"Your account has been successfully created. Please log in.\"</span><br>\r\n</li>\r\n<li>\r\n<span>As your new account does not have access to the dashboard, first log in as auto-generated administrative account with email: \"admin@example.com\" and password \"admin1234\"</span><br>\r\n</li>\r\n<li>\r\n<span>You are now in the dashboard panel, you should see the list with all registered users.&nbsp;</span><br>\r\n</li>\r\n<li>\r\n<span>Click on Edit next to the user that you've created and select \"Admin\" checkbox. Save the form clicking Save button.</span><br>\r\n</li>\r\n<li>\r\n<span>Relogin to your created user and remove default admin user in order to secure your blog.</span>\r\n</li>\r\n</ol><p><strong><br></strong></p><p><strong>Setting up the Blog<br></strong></p><ol>\r\n<li>\r\n<span>Go to the dashboard and click on Blog link in the left navigation</span><br>\r\n</li>\r\n<li><span>You will see three links at the top of the page, follow with Blog Settings</span></li>\r\n<li><span>Adjust your blog default settings. The following configuration options are available:</span></li>\r\n</ol><span></span><ul>\r\n<li>\r\n<span>title - title of your blog displayed at the top</span><br>\r\n</li>\r\n<li>\r\n<span>subtitle - subtitle displayed below the title</span><br>\r\n</li>\r\n<li>\r\n<span>sidebar enabled - enables right sidebar column with tags and social media integration</span><br>\r\n</li>\r\n<li>\r\n<span>grid view enabled - changes alignment of the post list</span><br>\r\n</li>\r\n<li>\r\n<span>tags filter - allows you to set tags that will later be available to add to your posts and search with on the main page</span><br>\r\n</li>\r\n<li>\r\n<span>facebook app id - generated by Facebook id that will let you connect your social media</span><br>\r\n</li>\r\n<li>\r\n<span>image - hero image of your blog</span><br>\r\n</li>\r\n<li>\r\n<span>social media links - social media links displayed in the sidebar</span><strong><br>\r\n</strong>\r\n</li>\r\n</ul><p><strong><br></strong></p><p><strong>Create your first post</strong></p><ol>\r\n<li>\r\n<span>Follow up with New Post link at the top of blog section</span><br>\r\n</li>\r\n<li>\r\n<span>Filll up the form, make sure you select Publish Now, otherwise your post will not be visible to the public.&nbsp;</span><br>\r\n</li>\r\n<li>\r\n<span>Click Save</span><br>\r\n</li>\r\n<li>\r\n<span>Congratulation, your first post is created. You can now delete or unpublish \"Getting Started Post\" so it's no longer visible on your blog.&nbsp;</span><br>\r\n</li>\r\n<li>\r\n<span>You are now set up with PlatformOS Blog.</span><br>\r\n</li>\r\n</ol><br>" },
      { "name": "excerpt", "value": "Thank you for installing PlatformOS Blog module. In this artile you will learn how to setup your blog and how to create new content." },
      { "name": "author_name", "value": "Adam" },
      { "name": "published_at", "value": "2019-04-03T00:00:00.000Z" },
      { "name": "blog_instance_id", "value": "{{ g.customization_create.id }}" }
    ]
  }
  {% endparse_json %}
  {% execute_query 'modules/dashboard_blog/migration_create_customization', data: blog_post %}

  {% assign image_url = 'modules/dashboard_blog/images/first_post_image.jpg' | asset_url %}
  {% log image_url, type: "Image Url" %}
  {% execute_query 'modules/dashboard_blog/create_image', result_name: "i", image_type: "hero_image", owner_id: g.customization_create.id, raw_url: image_url %}
  {% log i, type: "Custom Image Created" %}
{% endif %}
